for(var docCookies={getItem:function(a){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(a,b,c,d,e,f){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var g="";if(c)switch(c.constructor){case Number:g=1/0===c?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}return document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":""),!0},removeItem:function(a,b,c){return a&&this.hasItem(a)?(document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(c?"; domain="+c:"")+(b?"; path="+b:""),!0):!1},hasItem:function(a){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var a=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),b=0;b<a.length;b++)a[b]=decodeURIComponent(a[b]);return a}},flush=["/help_desk","/admin","/workers"],i=0;i<flush.length;i++)docCookies.removeItem("sessionToken",flush[i]),docCookies.removeItem("type",flush[i]),docCookies.removeItem("id",flush[i]);var app=angular.module("childrensFund",["ui.router","ngCookies","xeditable","angularFileUpload"]);app.run(["editableOptions",function(a){a.theme="bs3"}]),app.config(["$stateProvider","$locationProvider","$urlRouterProvider",function(a,b,c){b.html5Mode(!0),c.otherwise("/404"),a.state("root",{url:"/",templateUrl:"/templates/public/home.html",controller:"donorController"}).state("pledge",{url:"^/pledge",templateUrl:"/templates/public/pledge.html",controller:"pledgeController"}).state("donationSubmitted",{url:"/submitted",templateUrl:"/templates/public/donationSubmitted.html",controller:"pledgeController"}).state("404",{url:"/404",templateUrl:"/templates/public/404.html"}).state("workers",{"abstract":!0,template:"<ui-view/>",data:{userType:"workers"}}).state("workers.account",{url:"/workers",templateUrl:"/templates/workers/account.html",resolve:{auth:["$q","$state","protect",function(a,b,c){var d=a.defer();return c("workers").then(function(a){a?d.resolve():(d.reject(),b.go("workers.signin"))}),d.promise}]},controller:function(a){a.go("workers.account.myAccount")}}).state("workers.account.myAccount",{url:"/myAccount",templateUrl:"/templates/workers/myAccount.html",controller:"workerController"}).state("workers.account.create",{url:"/create",templateUrl:"/templates/workers/createChildTag.html",controller:"workerController"}).state("workers.account.myTags",{url:"/myTags",templateUrl:"/templates/workers/childrenFeed.html",controller:"workerController"}).state("workers.signup",{url:"/workers/signup",templateUrl:"/templates/authentication/signupView.html",resolve:{authenticate:["$http","$q","$state",function(a,b,c){var d=b.defer();return a({method:"GET",url:"/auth/toggle"}).then(function(a){a.data.access?d.resolve():(d.reject(),c.go("workers.signin"))}),d.promise}]},controller:"authController"}).state("workers.signin",{url:"/workers/signin",templateUrl:"/templates/authentication/signinView.html",controller:"authController"}).state("workers.sendReset",{url:"/workers/send_reset",templateUrl:"/templates/authentication/sendResetView.html",controller:"authController"}).state("workers.resetPassword",{url:"/workers/reset_password/:resetToken",templateUrl:"/templates/authentication/resetPasswordView.html",controller:"authController"}).state("workers.signout",{template:"<ui-view/>",controller:"signoutController"}).state("admin",{"abstract":!0,template:"<ui-view/>",data:{userType:"admin"}}).state("admin.account",{url:"/admin",templateUrl:"/templates/admin/account.html",resolve:{auth:["$q","$state","protect",function(a,b,c){var d=a.defer();return c("admin").then(function(a){a?d.resolve():(d.reject(),b.go("admin.signin"))}),d.promise}]}}).state("admin.account.children",{url:"/children",controller:"adminController",templateUrl:"/templates/admin/children.html"}).state("admin.account.workers",{url:"/workers",controller:"adminController",templateUrl:"/templates/admin/workers.html"}).state("admin.account.reports",{url:"/reports",controller:"adminController",templateUrl:"/templates/admin/reports.html"}).state("admin.account.accountManagement",{"abstract":!0,url:"/manage",template:"<ui-view/>",controller:"usersController"}).state("admin.account.accountManagement.create",{url:"/create",templateUrl:"/templates/admin/account/create.html",controller:"authController"}).state("admin.account.accountManagement.workers",{url:"/workers",templateUrl:"/templates/admin/account/users.html",controller:"usersController"}).state("admin.account.accountManagement.admin",{url:"/admin",templateUrl:"/templates/admin/account/users.html",controller:"usersController"}).state("admin.account.accountManagement.helpDesk",{url:"/help_desk",templateUrl:"/templates/admin/account/users.html",controller:"usersController"}).state("admin.signin",{url:"/admin/signin",templateUrl:"/templates/authentication/signinView.html",controller:"authController"}).state("admin.sendReset",{url:"/admin/send_reset",templateUrl:"/templates/authentication/sendResetView.html",controller:"authController"}).state("admin.resetPassword",{url:"/admin/reset_password/:resetToken",templateUrl:"/templates/authentication/resetPasswordView.html",controller:"authController"}).state("admin.signout",{template:"<ui-view/>",controller:"signoutController"}).state("helpDesk",{"abstract":!0,template:"<ui-view/>",data:{userType:"helpDesk"}}).state("helpDesk.account",{url:"/help_desk",templateUrl:"/templates/helpDesk/account.html",resolve:{auth:["$q","$state","protect",function(a,b,c){var d=a.defer();return c("helpDesk").then(function(a){a?d.resolve():(d.reject(),b.go("helpDesk.signin"))}),d.promise}]},controller:"authController"}).state("helpDesk.account.accountManagement",{"abstract":!0,template:"<ui-view/>",controller:"usersController"}).state("helpDesk.account.accountManagement.create",{url:"/create",templateUrl:"/templates/helpDesk/account/create.html",controller:"authController"}).state("helpDesk.account.accountManagement.workers",{url:"/workers",templateUrl:"/templates/helpDesk/account/users.html",controller:"usersController"}).state("helpDesk.account.accountManagement.admin",{url:"/admin",templateUrl:"/templates/helpDesk/account/users.html",controller:"usersController"}).state("helpDesk.account.accountManagement.helpDesk",{url:"/help_desk",templateUrl:"/templates/helpDesk/account/users.html",controller:"usersController"}).state("helpDesk.signin",{url:"/help_desk/signin",templateUrl:"/templates/authentication/signinView.html",controller:"authController"}).state("helpDesk.sendReset",{url:"/help_desk/send_reset",templateUrl:"/templates/authentication/sendResetView.html",controller:"authController"}).state("helpDesk.resetPassword",{url:"/help_desk/reset_password/:resetToken",templateUrl:"/templates/authentication/resetPasswordView.html",controller:"authController"}).state("helpDesk.signout",{template:"<ui-view/>",controller:"signoutController"})}]),app.controller("appController",["$scope","$cookies","signout",function(a,b,c){a.signout=function(){c()},a.devSignin=function(){console.log("Signed in as developer"),b.type="developer"}}]),app.controller("donorController",["$scope","restful","sanitize",function(a,b,c){a.get=function(d){a.page=d,b.getChildren(d).then(function(b){if(b){a.numChildren=b.data.shift(),a.pages=[];for(var d=0;d<a.numChildren/20;d++)a.pages.push(d+1);a.children=b.data,_.each(a.children,function(a){a.dob&&(a.dob=c.get(a.dob))})}})},a.get(1)}]),app.controller("usersController",["$scope","$http","$state",function(a,b,c){switch(c.current.url){case"/workers":a.userType="Staff";break;case"/admin":a.userType="Admin";break;case"/help_desk":a.userType="Help Desk"}a.workerPage="admin.account.accountManagement.workers"===c.current.name||"helpDesk.account.accountManagement.workers"===c.current.name?!0:!1,a.fetchUsers=function(d){var e="";if(a.userQuery){var f=a.userQuery;a.userQuery="",e="&query="+f}a.page=d,b({method:"GET",url:"/users"+c.current.url+"/accounts?page="+d+e}).success(function(b){console.log("Users fetched successfully"),a.page=d,a.numUsers=b.shift(),a.users=b,a.pages=[];for(var c=0;c<a.numUsers/20;c++)a.pages.push(c+1)}).error(function(){console.log("Users not fetched successfully: Server Error")})},"admin.account.accountManagement.create"!==c.current.name&&"helpDesk.account.accountManagement.create"!==c.current.name&&a.fetchUsers(1),a.issuePasswordReset=function(a){a.waitPasswordReset=1,b({method:"POST",url:"/auth/sendReset",data:{userType:c.current.name.split(".")[3],email:a.email}}).success(function(){a.waitPasswordReset=2,console.log("Reset token sent")}).error(function(){a.waitPasswordReset=3,console.log("Reset token not sent: Server Error")})},a.revokeAccess=function(a){var d;switch(a.waitAccess=1,c.current.url){case"/help_desk":d="helpDesk";break;case"/admin":d="admin";break;case"/workers":d="workers"}b({method:"POST",url:"/auth/access",data:{id:a.id,hasAccess:!1,userType:d}}).success(function(){a.waitAccess=2,console.log("User access revoked"),a.hasAccess=!1}).error(function(){a.waitAccess=3,console.log("Something went wrong")})},a.grantAccess=function(a){var d;switch(a.waitAccess=1,c.current.url){case"/help_desk":d="helpDesk";break;case"/admin":d="admin";break;case"/workers":d="workers"}b({method:"POST",url:"/auth/access",data:{id:a.id,hasAccess:!0,userType:d}}).success(function(){a.waitAccess=2,console.log("User access granted"),a.hasAccess=!0}).error(function(){a.waitAccess=3,console.log("Something went wrong")})}}]),app.controller("adminController",["$scope","$http","$state","$location",function(a,b,c){a.generatingReport,a.fetchAllChildren=function(c){var d="";if(a.userQuery){var e=a.userQuery;a.userQuery="",d="&query="+e}a.page=c,b({method:"GET",url:"/users/children?page="+c+d}).success(function(b){a.numChildren=b.shift(),a.children=b,a.pages=[];for(var c=0;c<a.numChildren/20;c++)a.pages.push(c+1)}).error(function(a){console.log(a)})},a.fetchAllWorkers=function(c){var d="";if(a.userQuery){var e=a.userQuery;a.userQuery="",d="&query="+e}a.page=c,b({method:"GET",url:"/users/workers?page="+c+d}).success(function(b){a.numWorkers=b.shift(),a.workers=b,a.pages=[];for(var c=0;c<a.numWorkers/20;c++)a.pages.push(c+1)}).error(function(a){console.log(a)})},"admin.account.children"===c.current.name?a.fetchAllChildren(1):"admin.account.workers"===c.current.name&&a.fetchAllWorkers(1),a.getWorker=function(a){b({method:"GET",url:"/api/children/"+a.id+"/worker"}).success(function(b){console.log(b),a.worker=b}).error(function(a){console.log(a)})},a.getChildren=function(a){b({method:"GET",url:"/api/workers/"+a.id+"/children"}).success(function(b){a.children=b}).error(function(a){console.log(a)})},a.setChildForModal=function(b,c){a.modalChild=b,a.modalWorker=c?c:null,a.matchedWorkers=null,a.swapWorker=null,a.success=null,a.swapWorkerForButton=null},a.fetchWorker=function(){var c=a.workerQuery;a.workerQuery="",b({method:"GET",url:"/api/worker?lastName="+c}).success(function(b){a.matchedWorkers=Array.isArray(b)?b:[b]}).error(function(a){console.log(a)})},a.setWorker=function(b){a.swapWorker=b},a.saveWorker=function(){console.log(a.swapWorker),b({method:"POST",url:"/api/children/"+a.modalChild.id+"/swap",data:{workerId:a.swapWorker.id}}).success(function(){if(a.success=!0,a.modalChild.worker)a.modalChild.worker.firstName=a.swapWorker.firstName,a.modalChild.worker.lastName=a.swapWorker.lastName;else for(var b=0;b<a.modalWorker.children.length;b++)if(a.modalWorker.children[b].id===a.modalChild.id&&a.modalWorker.id!==a.swapWorker.id){a.modalWorker.children.splice(b,1);break}a.tempWorkerForButton=a.swapWorker}).error(function(a){console.log(a)})},a.generateReport=function(){a.startDate&&a.endDate&&a.startDate<a.endDate?(a.generatingReport=!0,a.generateReportMessage="Creating Your Report",b({method:"POST",url:"/api/generate",data:{startDate:a.startDate,endDate:a.endDate}}).success(function(b){a.generateReportMessage="Report Created, Downloading Now",a.error=null,window.location="/api/download/"+b.filename}).error(function(){a.generateReportMessage=null,a.error="Something went wrong, try refreshing the page and submitting a new request",console.log("Report not generated, server error")})):a.error="Please enter valid start and end date"}}]),app.controller("authController",["$scope","$http","$state","$cookies","$stateParams","$location","oneTimeAuthorization","sessionCache",function(a,b,c,d,e,f,g,h){switch(a.stateUserType=c.current.name.split(".")[0],a.stateUserType){case"workers":a.userHeader="Staff";break;case"helpDesk":a.userHeader="Help Desk";break;case"admin":a.userHeader="Admin"}a.signup=function(d){if(a.error=null,a.waitSignup=!0,a.password===a.passwordConfirmation){var e,f,g,h,i;g=a.email,d?(e=a.userType,h=a.firstName,i=a.lastName,f=Math.random().toString(),a.email="",a.firstName="",a.lastName=""):(h=a.firstName,i=a.lastName,e=c.current.data.userType,f=a.password,a.firstName="",a.lastName="",a.password="",a.passwordConfirmation="",a.email=""),console.log(e),h&&i&&g&&e?b({method:"POST",url:"/auth/signup",data:{firstName:h,lastName:i,userType:e,email:g,password:f}}).success(function(){a.waitSignup=!1,a.success="User successfully created and should check email for password reset",d?a.sendReset(e,g):(a.email=g,a.password=f,a.signin())}).error(function(){console.log("User Not Created: Server Error"),a.waitSignup=!1,a.error="E-mail address: "+g+" already in use"}):(a.error="Please fill all fields",a.waitSignup=!1)}else a.error="Password and Password Confirmation Don't Match",a.waitSignup=!1},a.signin=function(){var e=c.current.data.userType;if(a.password){var i=a.email,j=a.password;a.email="",a.password="",b({method:"POST",url:"/auth/signin",data:{userType:e,email:i,password:j}}).success(function(a){switch(console.log("User signed in"),d.sessionToken=a.sessionToken,d.type=a.type,d.id=a.id,h.updateSessionToken(a.sessionToken),h.updateUserType(a.type),g.authorize(),a.type){case"workers":f.path("/workers");break;case"admin":f.path("/admin");break;case"helpDesk":f.path("/help_desk")}}).error(function(){a.error="Incorrect Username or Password",console.log("User not signed in: Server Error")})}},a.signout=function(){b({method:"POST",url:"/auth/signout"}).success(function(){d.sessionToken="j:null",d.type="j:null",d.id="j:null",console.log("User signed out")}).error(function(){console.log("User not signed out: Server Error")})},a.signedIn=function(){b({method:"POST",url:"/auth/signedIn",data:{userType:c.current.data.userType}}).success(function(){}).error(function(){})},a.sendReset=function(d,e){a.waitSendPassword=1,b({method:"POST",url:"/auth/sendReset",data:{userType:d||c.current.data.userType,email:e||a.email}}).success(function(){console.log("Reset token sent"),a.error="",a.status="Password reset sent to email: "+a.email}).error(function(){a.error="Email not found",a.waitSendPassword=0,console.log("Reset token not sent: Server Error")})},a.resetPassword=function(){a.password===a.passwordConfirmation?b({method:"POST",url:"/auth/resetPassword",data:{userType:c.current.data.userType,password:a.password,resetToken:e.resetToken}}).success(function(){console.log("Password successfully reset, sending you to signin page"),c.go(c.current.data.userType+".signin")}).error(function(){console.log("Password not reset: Server Error"),a.error="We couldn't find your account. This can happen if you used an old password reset link. Check your email for a newer password reset email or contact the help desk."}):(a.password="",a.passwordConfirmation="",a.error="Password and Password Confirmation Didn't Match")},a.fetchWorkerSignup=function(){b({method:"GET",url:"/auth/toggle"}).success(function(b){a.hasAccess=b.access})},a.toggleWorkerSignup=function(){b({method:"POST",url:"/auth/toggle"}).success(function(b){a.hasAccess=b.access}).error(function(){console.log("Something went wrong")})},"admin.account.accountManagement.create"===c.current.name&&(a.fetchWorkerSignup(),a.url="http://"+f.host(),f.port()&&(a.url+=":"+f.port()),a.url+="/workers/signup")}]),app.controller("signoutController",["$scope","$http","$state","$cookies",function(a,b,c){b({method:"POST",url:"/auth/signout"}).success(function(){console.log("User signed out"),docCookies.removeItem("sessionToken"),docCookies.removeItem("type"),docCookies.removeItem("id"),console.log(c.current.name);var a=c.current.name.split(".");c.go(a[0]+".signin")}).error(function(){console.log("Something went wrong")})}]),app.controller("workerController",["$scope","restful","sanitize","$cookies","$state","$location",function(a,b,c,d,e){a.tempChildObj={},a.deleteConfirm="";var f;a.genders=[{value:"male",text:"male"},{value:"female",text:"female"}],a.paymentMethods=[{value:"Items",text:"Items"},{value:"Cash",text:"Cash"},{value:"Check",text:"Check"}],a.getWorkerData=function(){b.getWorkerData().then(function(b){b&&(a.workerData=b.data)})},a.getWorkerData(),a.postWorkerData=function(a,d){d=c.update(a,d);var e={};e[a]=d,b.postWorkerData(e).then(function(a){})},a.unpledge=function(c,d){("delete"===d||"DELETE"===d)&&(c.waitDelete=1,f={},f.donorId=null,f.sortedByDate=new Date,f.status=0,f.hsaStatus=0,f.id=c.id,b.updateChild(f).then(function(a){a&&(c.waitDelete=2,c.status=0)})),a.deleteConfirm=""},a.create=function(){a.tempChildObj.phone&&(a.tempChildObj.phone=c.update("phone",a.tempChildObj.phone)),(a.tempChildObj.firstItemPrice||a.tempChildObj.secondItemPrice||a.tempChildObj.thirdItemPrice)&&(a.tempChildObj.firstItemPrice=c.update("firstItemPrice",a.tempChildObj.firstItemPrice),a.tempChildObj.secondItemPrice=c.update("secondItemPrice",a.tempChildObj.secondItemPrice),a.tempChildObj.thirdItemPrice=c.update("thirdItemPrice",a.tempChildObj.thirdItemPrice)),a.tempChildObj.sortedByDate=new Date,b.createChild(a.tempChildObj).then(function(a){a&&e.go("workers.account.myTags")})},a.get=function(d){a.page=d,b.getWorkersChildren(d).then(function(b){b&&(a.children=b.data,_.each(a.children,function(a){a.dob&&(a.dob=c.get("dob",a.dob))}))})},a.updateDonor=function(a,d,e){e=c.update(d,e),f={},f.id=a,f[d]=e,console.log(f),b.updateDonor(f).then(function(a){a&&console.log("edit donor success!")})},a.getChildsDonor=function(c){a.childsDonor={},b.getChildsDonor(c).then(function(b){b&&(a.childsDonor=b.data)})},a.update=function(a,d,e){e=c.update(d,e),f={},f.id=a,f[d]=e,b.updateChild(f).then(function(a){a&&console.log("update success!")})},a.get(1),a.checkData=function(a,b){return"firstName"!==b&&"lastName"!==b||!Boolean(a.match(/[^\w-'`]/g))?"age"===b&&Boolean(a.match(/[^\d]/g))?"Please enter only numbers":"price"===b&&Boolean(a.match(/[^\d$.]/g))?"Please enter only numbers":"paymentMethod"===b&&(str=a[0].toUpperCase()+a.slice(1),"Cash"!==str&&"Check"!==str&&"Items"!==str)?(console.log(str,a),"Please enter only numbers"):void 0:"Valid characters are letters and -`'"},a.setModalChild=function(b){a.modalChild=b}}]),app.controller("pledgeController",["$scope","restful","childObjSaver","$state","$timeout",function(a,b,c,d,e){a.currentChild=c.getChildObj()||void 0;var f,g=function(){for(var a=0,b=0;b<arguments.length;b++)arguments[b]&&(a+=Number(arguments[b]));return a};a.$watch("currentChild",function(){a.currentChild.itemTotalPrice=g(a.currentChild.firstItemPrice,a.currentChild.secondItemPrice,a.currentChild.thirdItemPrice)}),a.pledgeButton=function(a){c.setChildObj(a)},a.donorSubmit=function(){f={},f.id=a.currentChild.id,f.status=1,b.updateChild(f).then(function(d){d&&(f.donor=a.donor,b.postDonor(f).then(function(b){b&&(a.confirmation=a.currentChild.cfid,e(function(){c.setChildObj()},3e3))}))})}}]),app.controller("imageController",["$scope","$upload","$cookies","randNum",function(a,b,c,d){var e=function(a){for(var b=a.name,c=b.length;c>=0;c--)if("."===b[c])return b.slice(c,b.length)};a.onFileSelect=function(b){a.file=b[0]},a.updatePhoto=function(c){var f=d(),g="";g+=f,g+=e(a.file),delete a.file.name,a.file.name=g,b.upload({url:"/images",method:"POST",file:a.file}).success(function(){console.log("Image Upload Success!...Updating kid now..."),a.$parent.update(c,"image",a.file.name)})},a.uploadImageThenCreateChild=function(){!a.$parent.tempChildObj.firstName||!a.$parent.tempChildObj.lastName||!a.$parent.tempChildObj.gender||""===a.$parent.tempChildObj.gender||!a.$parent.tempChildObj.dob||!a.$parent.tempChildObj.age||!a.$parent.tempChildObj.location||!a.$parent.tempChildObj.programArea||!a.$parent.tempChildObj.bio||a.$parent.tempChildObj.bio.length>600||!a.$parent.tempChildObj.firstItemName&&a.$parent.tempChildObj.firstItemName.length>16||a.$parent.tempChildObj.secondItemName&&a.$parent.tempChildObj.secondItemName.length>16||a.$parent.tempChildObj.thirdItemName&&a.$parent.tempChildObj.thirdItemName.length>16||!a.$parent.tempChildObj.firstItemPrice||(a.file?(a.$parent.tempChildObj.image="",a.$parent.tempChildObj.image+=d(),a.$parent.tempChildObj.image+=e(a.file),delete a.file.name,a.file.name=a.$parent.tempChildObj.image,b.upload({url:"/images",method:"POST",file:a.file}).success(function(){console.log("Image Upload Success!...Creating kid now..."),a.$parent.create()})):(console.log("No Image Upload...Creating kid..."),a.$parent.create()))}}]),app.factory("restful",["$http","$cookies",function(a,b){return{createChild:function(c){return a({method:"POST",url:"/api/workers/"+b.id+"/children",data:c}).success(function(a){return console.log("(postChild) POST Success! ",a),a}).error(function(a,b){console.log("(postChild) POST Error! ",a,b)})},updateChild:function(b){return a({method:"POST",url:"/api/children/"+b.id,data:b}).success(function(a){return console.log("(updateChild) POST Success! ",a),a}).error(function(a,b){console.log("(updateChild) POST Error! ",a,b)})},getChildren:function(b){var c="/api/children";return b&&(c+="?page="+b),a({method:"GET",url:c}).success(function(a){return console.log("(getChildren) GET Success! ",a),a}).error(function(a,b){console.log("(getChildren) GET Error! ",a,b)})},getWorkersChildren:function(){return a({method:"GET",url:"/api/workers/"+b.id+"/children"}).success(function(a){return console.log("(getWorkersChildren) GET Success! ",a),a}).error(function(a,b){console.log("(getWorkersChildren) GET Error! ",a,b)})},getWorkerData:function(){return a({method:"GET",url:"/api/workers/"+b.id}).success(function(a){return console.log("(getWorkerData) GET Success! ",a),a}).error(function(a,b){console.log("(getWorkerData) GET Error! ",a,b)})},postWorkerData:function(c){return a({method:"POST",url:"/api/workers/"+b.id,data:c}).success(function(a){return console.log("(postWorkerData) POST Success! ",a),a}).error(function(a,b){console.log("(postWorkerData) POST Error! ",a,b)})},getChildsDonor:function(b){return a({method:"GET",url:"/api/children/"+b+"/donor"}).success(function(a){return console.log("(getChildsDonor) GET Success! ",a),a}).error(function(a,b){console.log("(getChildsDonor) GET Error! ",a,b)})},postDonor:function(b){return a({method:"POST",url:"/api/children/"+b.id+"/donor",data:b.donor}).success(function(a){return console.log("(postDonor) POST Success! ",a),a}).error(function(a,b){console.log("(postDonor) POST Error! ",a,b)})},updateDonor:function(b){return a({method:"POST",url:"/api/donors/"+b.id,data:b}).success(function(a){return console.log("(updateDonor) POST Success! ",a),a}).error(function(a,b){console.log("(updateDonor) POST Error! ",a,b)})}}}]),app.factory("oneTimeAuthorization",[function(){var a=!1;return{authorize:function(){a=!0},isAuthorized:function(){var b=a;return a=!1,b}}}]),app.factory("sessionCache",[function(){var a={},b={};return b.updateSessionToken=function(b){a.sessionToken=b},b.updateUserType=function(b){a.userType=b},b.retrieveSessionToken=function(){return a.sessionToken},b.retrieveUserType=function(){return a.userType},b}]),app.factory("protect",["$cookies","$q","$http","sessionCache","oneTimeAuthorization",function(a,b,c,d,e){return function(f){var g=a.sessionToken,h=a.type;console.log("################ Page is protected, checking login status ################");var i=b.defer();return e.isAuthorized()?(console.log("One time authorization token used"),i.resolve(!0)):"developer"===h?(console.log("Logged in as developer, granting access"),i.resolve(!0)):g&&h&&"j:null"!==g&&"j:null"!==h?d.retrieveSessionToken()===g&&d.retrieveUserType()===h&&h===f?(console.log("Cached credentials"),i.resolve(!0)):(console.log("Client has sessionId cookie, but no sessionId is cached in Angular. Awaiting server verification"),c({method:"POST",url:"/auth/signedIn",data:{userType:f}}).success(function(a){a.signedIn?(console.log("Client authorized"),d.updateSessionToken(g),d.updateUserType(h),i.resolve(!0)):(console.log("Client unauthorized"),i.resolve(!1))}).error(function(){console.log("Server error: Preventing client access regardless"),i.reject("There was a server error")})):(console.log("Session token is null"),i.resolve(!1)),i.promise}}]),app.factory("signout",["$http","$state","$cookies",function(a,b){return function(){return a({method:"POST",url:"/auth/signout"}).success(function(){console.log("User signed out"),docCookies.removeItem("sessionToken"),docCookies.removeItem("type"),docCookies.removeItem("id"),console.log(b.current.name);var a=b.current.name.split(".");b.go(a[0]+".signin")}).error(function(){console.log("Something went wrong")})}}]),app.service("childObjSaver",[function(){var a={};return{setChildObj:function(b){b=b||{},a=b},getChildObj:function(){return a}}}]),app.service("sanitize",[function(){return{update:function(a,b){if("phone"===a){var c,d="";if(b){if(c=b.match(/\d+/g).join("").split("").reverse(),c.length<=11){for(var e=0;e<c.length;e++)(4===e||7===e||10===e)&&(d+="-"),d+=c[e];return d.split("").reverse().join("")}return c.reverse().join("")}return void 0}return"Price"===a.substr(a.length-5,a.length)?b?("$"===b[0]&&(b=b.slice(1)),Number(b)):void 0:"dob"===a||"Date"===a.substr(a.length-4,a.length)?b.substr(0,4)+b.substr(4,6):(console.log("no sanitization needed!"),b)},post:function(){},get:function(a,b){return"dob"===a||"Date"===a.substr(a.length-4,a.length)?b.substr(5,6)+"-"+b.substr(0,4):void 0}}}]),app.service("randNum",[function(){return function(){return Math.floor(1e11*Math.random())}}]);